{%  extends 'layouts/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Fotos de la Casa en Alquiler en Bariloche, Nahuel Malal norte | Contacto | Stanza della Nonna" %}{% endblock %}

{% block head_extra %}
<meta name="description" content="Conocé la casa por dentro y por fuera: galería de fotos de Stanza della Nonna en Bariloche. Vista al lago, comodidades y entorno natural.">
<meta property="og:title" content="Fotos de la Casa en Alquiler en Bariloche | Stanza della Nonna">
<meta property="og:description" content="Conocé la casa por dentro y por fuera: galería de fotos de Stanza della Nonna en Bariloche, Nahuel Malal norte. Vista al lago, comodidades y entorno natural.">
<meta property="og:image" content="https://stanzadellanonna.com.ar/img/galeria-stanza.jpg">
<meta property="og:url" content="https://stanzadellanonna.com.ar/fotos">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Alquiler de Casa en Bariloche con Vista al Lago | Stanza della Nonna">
<meta name="twitter:description" content="Alquiler de casa turística en Bariloche con vista al lago. Espaciosa, luminosa y equipada para 6 personas. Ideal para descansar o explorar la Patagonia.">
<meta name="twitter:image" content="https://stanzadellanonna.com.ar/img/casa-bariloche-portada.jpg">

<style>
  /* Animaciones personalizadas */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-fade-in {
    animation: fadeIn 0.5s ease-out forwards;
  }

  /* Transiciones suaves para imágenes */
  .gallery-item {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .gallery-item:hover {
    transform: scale(1.02);
  }

  /* Modal personalizado */
  .modal-overlay {
    backdrop-filter: blur(10px);
    background: rgba(0, 0, 0, 0.8);
  }

  .modal-content {
    max-height: 90vh;
  }

  /* Grid responsive mejorado */
  .gallery-grid {
    display: grid;
    gap: 1.5rem;
  }

  @media (min-width: 640px) {
    .gallery-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .gallery-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1536px) {
    .gallery-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* Efecto de carga */
  .image-loading {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }

  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Botones de navegación */
  .nav-dot {
    transition: all 0.3s ease;
  }

  .nav-dot.active {
    transform: scale(1.2);
  }
</style>
{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="py-12 bg-gradient-to-b from-gray-50 to-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <span class="text-sm font-semibold text-amber-600 tracking-widest uppercase mb-4 block">
        {% trans "Galería Visual" %}
      </span>
      <h1 class="font-serif text-4xl md:text-5xl lg:text-6xl text-gray-900 mb-6">
        {% trans "Descubrí la casa" %}
      </h1>
      <p class="text-gray-600 text-lg max-w-2xl mx-auto">
        {% trans "Explorá cada rincón de Stanza della Nonna a través de nuestra galería fotográfica." %}
      </p>
    </div>

    <!-- Breadcrumb de carpetas -->
    {% if subcarpeta %}
    <div class="mb-8">
      <nav class="flex items-center justify-center space-x-2 text-sm">
        <a href="{% url 'galeria' %}" class="text-gray-500 hover:text-gray-700 transition-colors">
          {% trans "Galería" %}
        </a>
        <span class="text-gray-400">/</span>
        <span class="text-amber-600 font-medium">{{ subcarpeta|title }}</span>
      </nav>
    </div>
    {% endif %}

    <!-- Botones de carpetas -->
    {% if carpetas %}
    <div class="flex flex-wrap justify-center gap-3 mb-12">
      {% if subcarpeta %}
      <a href="{% url 'galeria' %}" 
         class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full transition-colors duration-300">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        {% trans "Volver" %}
      </a>
      {% endif %}
      
      {% for carpeta in carpetas %}
      <a href="{% url 'galeria_sub' subcarpeta|add:carpeta|add:'/' %}"
         class="inline-flex items-center gap-2 px-6 py-3 bg-white hover:bg-gray-50 text-gray-800 rounded-xl border border-gray-200 hover:border-amber-300 transition-all duration-300 hover:shadow-lg">
        <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        {{ carpeta }}
      </a>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</section>

<!-- Gallery Grid -->
<section class="py-12 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {% if imagenes %}
    <div class="gallery-grid">
      {% for imagen in imagenes %}
      <div class="gallery-item animate-fade-in" style="animation-delay: {{ forloop.counter0|divisibleby:3|yesno:'0,0.1,0.2' }}s">
        <div class="relative overflow-hidden rounded-2xl shadow-lg group cursor-pointer" 
             onclick="openLightbox('{{ forloop.counter0 }}')">
          <!-- Placeholder de carga -->
          <div class="image-loading absolute inset-0 rounded-2xl"></div>
          
          <!-- Imagen -->
          <img 
            src="{% static imagen %}" 
            alt="{% trans 'Foto de la casa' %} {{ forloop.counter }}"
            class="w-full h-64 md:h-80 object-cover transition-transform duration-500 group-hover:scale-110"
            loading="lazy"
            onload="this.previousElementSibling.style.display = 'none'"
          >
          
          <!-- Overlay hover -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6">
            <div class="text-white transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z"/>
                </svg>
                <span class="font-medium">{% trans "Ver imagen" %}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Contador de imágenes -->
    <div class="mt-12 text-center text-gray-500">
      <p class="text-sm">
        {{ imagenes|length }} {% trans "imágenes" %}
        {% if subcarpeta %}
          {% trans "en" %} {{ subcarpeta }}
        {% endif %}
      </p>
    </div>
    {% else %}
    <!-- Estado vacío -->
    <div class="text-center py-24">
      <svg class="w-24 h-24 text-gray-300 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <h3 class="text-xl font-medium text-gray-900 mb-2">{% trans "No hay imágenes disponibles" %}</h3>
      <p class="text-gray-600 max-w-md mx-auto">
        {% trans "Actualmente no hay imágenes en esta categoría. Pronto agregaremos más contenido." %}
      </p>
    </div>
    {% endif %}
  </div>
</section>

<!-- Lightbox Modal -->
<div id="lightbox-modal" class="fixed inset-0 z-50 hidden modal-overlay">
  <div class="relative w-full h-full flex items-center justify-center p-4">
    <!-- Botón cerrar -->
    <button onclick="closeLightbox()" 
            class="absolute top-6 right-6 z-10 w-12 h-12 bg-black/50 hover:bg-black/75 rounded-full flex items-center justify-center text-white transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Botón anterior -->
    <button onclick="changeImage(-1)" 
            class="absolute left-6 top-1/2 transform -translate-y-1/2 z-10 w-12 h-12 bg-black/50 hover:bg-black/75 rounded-full flex items-center justify-center text-white transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>

    <!-- Botón siguiente -->
    <button onclick="changeImage(1)" 
            class="absolute right-6 top-1/2 transform -translate-y-1/2 z-10 w-12 h-12 bg-black/50 hover:bg-black/75 rounded-full flex items-center justify-center text-white transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>

    <!-- Contenedor de imagen -->
    <div class="modal-content w-full max-w-6xl mx-auto">
      <div class="relative">
        <!-- Imagen -->
        <img id="lightbox-image" 
             class="w-full h-auto max-h-[80vh] object-contain rounded-lg"
             alt=""
             loading="eager">
        
        <!-- Contador -->
        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-full text-sm">
          <span id="current-index">1</span> / <span id="total-images">{{ imagenes|length }}</span>
        </div>
      </div>
    </div>

    <!-- Navegación inferior -->
    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-2 z-10">
      {% for imagen in imagenes %}
      <button onclick="goToImage({{ forloop.counter0 }})" 
              class="nav-dot w-3 h-3 bg-white/50 hover:bg-white rounded-full transition-all"></button>
      {% endfor %}
    </div>
  </div>
</div>

<!-- CTA Section -->
<section class="py-16 bg-gradient-to-br from-gray-50 to-amber-50">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h2 class="font-serif text-3xl md:text-4xl text-gray-900 mb-6">
      {% trans "¿Te gustó lo que viste?" %}
    </h2>
    <p class="text-gray-600 mb-10 text-lg">
      {% trans "Contactanos para más información o para reservar tu estadía." %}
    </p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="https://wa.me/5492215114083?text=Hola!%20Vi%20las%20fotos%20de%20la%20casa%20y%20quiero%20más%20información."
         class="inline-flex items-center justify-center gap-3 bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-full font-medium transition-all duration-300 transform hover:scale-105 shadow-lg">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91 0-5.46-4.45-9.91-9.91-9.91zm5.23 13.58c-.33.92-1.59 1.68-2.58 1.87-.57.1-1.31.18-2.25-.37-.75-.43-1.29-1.01-2.04-1.61-1.42-1.17-2.35-2.62-2.58-2.97-.23-.35-.19-.8.08-1.12.24-.30.56-.47.94-.47.21 0 .42.05.60.16.18.10.42.31.67.56.25.25.49.55.70.83.19.26.39.52.56.77.17.25.31.50.44.73.13.23.23.45.30.66.07.21.10.40.10.58 0 .17-.03.33-.08.48-.05.15-.12.29-.21.42z"/>
        </svg>
        {% trans "Consultar por WhatsApp" %}
      </a>
      <a href="{% url 'index' %}"
         class="inline-flex items-center justify-center gap-3 bg-white hover:bg-gray-50 text-gray-800 px-8 py-4 rounded-full font-medium transition-all duration-300 transform hover:scale-105 shadow-lg border border-gray-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
        </svg>
        {% trans "Volver al inicio" %}
      </a>
    </div>
  </div>
</section>

<script>
  // Variables globales para el lightbox
  let currentImageIndex = 0;
  const images = [
    {% for imagen in imagenes %}
      "{% static imagen %}",
    {% endfor %}
  ];

  // Abrir lightbox
  function openLightbox(index) {
    currentImageIndex = parseInt(index);
    updateLightbox();
    document.getElementById('lightbox-modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }

  // Cerrar lightbox
  function closeLightbox() {
    document.getElementById('lightbox-modal').classList.add('hidden');
    document.body.style.overflow = 'auto';
  }

  // Cambiar imagen
  function changeImage(direction) {
    currentImageIndex += direction;
    
    // Circular navigation
    if (currentImageIndex < 0) {
      currentImageIndex = images.length - 1;
    } else if (currentImageIndex >= images.length) {
      currentImageIndex = 0;
    }
    
    updateLightbox();
  }

  // Ir a imagen específica
  function goToImage(index) {
    currentImageIndex = index;
    updateLightbox();
  }

  // Actualizar lightbox
  function updateLightbox() {
    const lightboxImage = document.getElementById('lightbox-image');
    const currentIndexSpan = document.getElementById('current-index');
    const totalImagesSpan = document.getElementById('total-images');
    const navDots = document.querySelectorAll('.nav-dot');
    
    // Actualizar imagen
    lightboxImage.src = images[currentImageIndex];
    
    // Actualizar contador
    currentIndexSpan.textContent = currentImageIndex + 1;
    totalImagesSpan.textContent = images.length;
    
    // Actualizar puntos de navegación
    navDots.forEach((dot, index) => {
      if (index === currentImageIndex) {
        dot.classList.add('active', 'bg-white');
        dot.classList.remove('bg-white/50');
      } else {
        dot.classList.remove('active', 'bg-white');
        dot.classList.add('bg-white/50');
      }
    });
  }

  // Navegación con teclado
  document.addEventListener('keydown', (e) => {
    const lightbox = document.getElementById('lightbox-modal');
    if (lightbox.classList.contains('hidden')) return;
    
    switch(e.key) {
      case 'Escape':
        closeLightbox();
        break;
      case 'ArrowLeft':
        changeImage(-1);
        break;
      case 'ArrowRight':
        changeImage(1);
        break;
    }
  });

  // Cerrar al hacer clic fuera
  document.getElementById('lightbox-modal').addEventListener('click', (e) => {
    if (e.target.id === 'lightbox-modal') {
      closeLightbox();
    }
  });

  // Lazy loading mejorado
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.gallery-item img');
    
    const imageObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.getAttribute('src');
          imageObserver.unobserve(img);
        }
      });
    }, { threshold: 0.1 });
    
    images.forEach(img => imageObserver.observe(img));
  });
</script>
{% endblock %}